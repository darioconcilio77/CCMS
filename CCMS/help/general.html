<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Role Center &amp; API â€“ CCMS Help</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>

<header class="topbar">
  <button class="topbar__menu-btn" aria-label="Toggle menu">&#9776;</button>
  <a href="index.html" class="topbar__logo">
    <div class="topbar__logo-icon">D4P</div>
    <div>
      <div class="topbar__product">CCMS Help</div>
      <div class="topbar__subtitle">Cloud Customer Management Solution</div>
    </div>
  </a>
  <div class="topbar__spacer"></div>
  <span class="topbar__version">v0.0.2.0 Â· BC 27.0+</span>
</header>

<div class="shell">
  <nav class="sidebar" aria-label="Help navigation">
    <div class="sidebar__inner">
      <span class="sidebar__section-title">Documentation</span>
      <ul class="sidebar__nav">
        <li><a href="index.html"><span class="nav-icon">ğŸ </span>Home</a></li>
        <li><a href="getting-started.html"><span class="nav-icon">ğŸš€</span>Getting Started</a></li>
      </ul>
      <span class="sidebar__section-title">Configuration</span>
      <ul class="sidebar__nav">
        <li><a href="setup.html"><span class="nav-icon">âš™ï¸</span>Setup</a></li>
        <li><a href="auth.html"><span class="nav-icon">ğŸ”</span>Authentication</a></li>
        <li><a href="permissions.html"><span class="nav-icon">ğŸ›¡ï¸</span>Permissions</a></li>
      </ul>
      <span class="sidebar__section-title">Core Data</span>
      <ul class="sidebar__nav">
        <li><a href="customer.html"><span class="nav-icon">ğŸ¢</span>Customers</a></li>
        <li><a href="tenant.html"><span class="nav-icon">ğŸŒ</span>Tenants</a></li>
        <li><a href="environment.html"><span class="nav-icon">ğŸ–¥ï¸</span>Environments</a></li>
      </ul>
      <span class="sidebar__section-title">Operations</span>
      <ul class="sidebar__nav">
        <li><a href="extension.html"><span class="nav-icon">ğŸ§©</span>Extensions</a></li>
        <li><a href="backup.html"><span class="nav-icon">ğŸ’¾</span>Backup</a></li>
        <li><a href="capacity.html"><span class="nav-icon">ğŸ“Š</span>Capacity</a></li>
        <li><a href="features.html"><span class="nav-icon">ğŸš¦</span>Features</a></li>
        <li><a href="session.html"><span class="nav-icon">ğŸ‘¤</span>Sessions</a></li>
        <li><a href="operation.html"><span class="nav-icon">â³</span>Operations</a></li>
      </ul>
      <span class="sidebar__section-title">Advanced</span>
      <ul class="sidebar__nav">
        <li><a href="telemetry.html"><span class="nav-icon">ğŸ“¡</span>Telemetry</a></li>
        <li><a href="general.html"><span class="nav-icon">ğŸ›ï¸</span>Role Center &amp; API</a></li>
      </ul>
    </div>
  </nav>

  <main class="main">
    <div class="content">

      <div class="page-header">
        <div class="page-header__breadcrumb">
          <a href="index.html">Home</a><span>â€º</span> Role Center &amp; API
        </div>
        <h1>Role Center &amp; API Helper</h1>
        <div class="page-header__meta">
          <span class="badge badge--namespace">D4P.CCMS.General</span>
          <span class="badge badge--module">Developer reference</span>
        </div>
      </div>

      <p>
        The General module provides the <strong>Role Center</strong> â€” the main homepage for
        CCMS administrators â€” as well as the shared <strong>D4P BC API Helper</strong> codeunit
        used by all modules to make authenticated HTTP calls to the BC Admin Center and
        Automation APIs.
      </p>

      <h2 id="role-center">Role Center</h2>
      <h3>Profile: D4P BC ADMIN</h3>
      <p>
        Users assigned the <code>D4P BC ADMIN</code> profile see the
        <strong>D365BC Admin Center Role Center</strong> as their BC homepage.
        To assign the profile: <em>Settings â†’ My Settings â†’ Role â†’ D365BC Admin Center</em>.
      </p>

      <h3>Role Center layout</h3>
      <ul>
        <li><strong>Headline</strong> â€“ motivational or informational text at the top (standard BC headline pattern).</li>
        <li><strong>Cue tiles</strong> â€“ KPI activity tiles showing counts for key entities.</li>
        <li><strong>Navigation actions</strong> â€“ quick links to all major CCMS list pages.</li>
      </ul>

      <h3>Cue tiles</h3>
      <div class="table-wrapper">
        <table>
          <thead><tr><th>Cue</th><th>Description</th></tr></thead>
          <tbody>
            <tr><td>Customers</td><td>Total number of customer records.</td></tr>
            <tr><td>Tenants</td><td>Total number of Entra tenant records.</td></tr>
            <tr><td>Active Environments</td><td>Environments with State = Active.</td></tr>
            <tr><td>Pending Updates</td><td>Environments with a scheduled or available update.</td></tr>
            <tr><td>Expiring Secrets</td><td>Tenants or app registrations with secrets expiring within 30 days.</td></tr>
          </tbody>
        </table>
      </div>

      <h2 id="api-helper">D4P BC API Helper codeunit</h2>
      <p>
        The <code>D4P BC API Helper</code> codeunit is the <strong>central HTTP communication
        layer</strong> for the entire solution. Every module that needs to call the
        BC Admin Center API or Automation API goes through this codeunit.
      </p>

      <h3>Main procedure</h3>
      <pre><code>procedure SendAdminAPIRequest(
    BCTenant     : Record "D4P BC Tenant";
    Method       : Text;        // 'GET', 'POST', 'PUT', 'PATCH', 'DELETE'
    Endpoint     : Text;        // e.g. '/applications/businesscentral/environments'
    RequestBody  : Text;        // JSON for POST/PUT/PATCH; '' for GET/DELETE
    var ResponseText : Text     // raw JSON response
): Boolean                      // true = HTTP 2xx; false = error</code></pre>

      <h3>Authentication flow</h3>
      <ol class="step-list">
        <li><div><strong>Retrieve credentials</strong> from the tenant's app registration (Client ID + secret from Isolated Storage).</div></li>
        <li><div><strong>Request an OAuth 2.0 access token</strong> from the Microsoft Entra token endpoint using the client credentials grant.</div></li>
        <li><div><strong>Set the <code>Authorization: Bearer &lt;token&gt;</code> header</strong> on the outgoing HTTP request.</div></li>
        <li><div><strong>Construct the full URL:</strong> <code>Setup.GetAdminAPIBaseUrl() + Endpoint</code>.</div></li>
        <li><div><strong>Send the request</strong> and return the raw JSON response body.</div></li>
      </ol>

      <h3>Error handling</h3>
      <ul>
        <li>Returns <code>false</code> and sets <code>ResponseText</code> to the error body on non-2xx HTTP responses.</li>
        <li>When <a href="setup.html">Debug Mode</a> is enabled, the full response is shown in a <code>Message()</code> dialog to aid troubleshooting.</li>
      </ul>

      <div class="callout callout--info">
        <div class="callout__title">For developers</div>
        When extending CCMS or adding a new Admin API endpoint, use
        <code>D4P BC API Helper.SendAdminAPIRequest()</code> rather than making direct
        <code>HttpClient</code> calls. This ensures consistent authentication, URL construction,
        error handling, and debug-mode logging across all modules.
      </div>

      <h2 id="related">Related modules</h2>
      <ul>
        <li><a href="auth.html">Authentication</a> â€“ app registrations that provide credentials to this helper.</li>
        <li><a href="setup.html">Setup</a> â€“ API base URLs consumed by this helper.</li>
        <li><a href="permissions.html">Permissions</a> â€“ the <code>D4P BC ADMIN</code> profile is defined here.</li>
      </ul>

    </div>
  </main>
</div>

<footer class="footer">
  &copy; Directions for Partners &bull; Cloud Customer Management Solution v0.0.2.0
</footer>
<script src="js/nav.js"></script>
</body>
</html>
